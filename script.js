const allQuestions = {
    "8th Grade": [
        {
            question: "What is the unit of electric current?",
            options: ["Volt", "Ohm", "Ampere", "Watt"],
            answer: "Ampere"
        },
        {
            question: "Which of the following is an example of a chemical change?",
            options: ["Melting ice", "Boiling water", "Rusting of iron", "Tearing paper"],
            answer: "Rusting of iron"
        },
        {
            question: "What is the force that pulls objects towards the center of the Earth?",
            options: ["Friction", "Gravity", "Magnetism", "Tension"],
            answer: "Gravity"
        },
        {
            question: "What is the value of x in the equation: 3x - 7 = 14?",
            options: ["5", "6", "7", "8"],
            answer: "7"
        },
        {
            question: "A number is increased by 20% to get 180. What was the original number?",
            options: ["144", "150", "160", "216"],
            answer: "150"
        },
        {
            question: "If a triangle has angles of 45° and 60°, what is the measure of the third angle?",
            options: ["65°", "75°", "80°", "90°"],
            answer: "75°"
        },
        {
            question: "What is the powerhouse of the cell?",
            options: ["Nucleus", "Ribosome", "Mitochondrion", "Cytoplasm"],
            answer: "Mitochondrion"
        },
        {
            question: "The process by which plants make their own food is called:",
            options: ["Respiration", "Transpiration", "Photosynthesis", "Digestion"],
            answer: "Photosynthesis"
        },
        {
            question: "Which blood type is considered the universal donor?",
            options: ["A", "B", "AB", "O"],
            answer: "O"
        },
        {
            question: "Identify the noun in the sentence: 'The quick brown fox jumps over the lazy dog.'",
            options: ["quick", "jumps", "dog", "over"],
            answer: "dog"
        },
        {
            question: "What is a synonym for 'benevolent'?",
            options: ["cruel", "kind", "arrogant", "sad"],
            answer: "kind"
        },
        {
            question: "Which of the following is a complete sentence?",
            options: ["Running fast.", "Because he was tired.", "She ran to the store.", "To the park."],
            answer: "She ran to the store."
        },
        {
            question: "What does 'CPU' stand for?",
            options: ["Central Processing Unit", "Computer Personal Unit", "Control Power Unit", "Central Program Utility"],
            answer: "Central Processing Unit"
        },
        {
            question: "Which of these is not a programming language?",
            options: ["Python", "Java", "HTML", "C++"],
            answer: "HTML"
        },
        {
            question: "What is a 'bug' in computer programming?",
            options: ["A type of virus", "An error or fault", "A feature that is not working", "A software update"],
            answer: "An error or fault"
        }
    ],
    "9th Grade": [
        {
            question: "What is the main function of the cell membrane?",
            options: ["To store genetic information", "To control what enters and leaves the cell", "To produce energy", "To carry out photosynthesis"],
            answer: "To control what enters and leaves the cell"
        },
        {
            question: "What is the term for a number that can be expressed as a fraction p/q, where p and q are integers and q is not zero?",
            options: ["Irrational number", "Real number", "Rational number", "Complex number"],
            answer: "Rational number"
        },
        {
            question: "What is the formula for the volume of a cylinder?",
            options: ["V = πr²h", "V = 4/3πr³", "V = lwh", "A = πr²"],
            answer: "V = πr²h"
        },
        {
            question: "What is the difference between speed and velocity?",
            options: ["Speed is a vector; velocity is a scalar", "Speed is a scalar; velocity is a vector", "They are the same thing", "Velocity is always faster than speed"],
            answer: "Speed is a scalar; velocity is a vector"
        },
        {
            question: "Which famous document begins with the words 'When in the Course of human events...'?",
            options: ["The US Constitution", "The Declaration of Independence", "The Bill of Rights", "The Emancipation Proclamation"],
            answer: "The Declaration of Independence"
        },
        {
            question: "What is the process by which a solid turns directly into a gas, without passing through the liquid phase?",
            options: ["Condensation", "Sublimation", "Evaporation", "Deposition"],
            answer: "Sublimation"
        },
        {
            question: "What is the capital of Australia?",
            options: ["Sydney", "Melbourne", "Canberra", "Brisbane"],
            answer: "Canberra"
        },
        {
            question: "In computer science, what is a 'variable'?",
            options: ["A type of error", "A container for storing data values", "A sequence of instructions", "A keyboard key"],
            answer: "A container for storing data values"
        },
        {
            question: "Which is the largest human organ?",
            options: ["Heart", "Brain", "Liver", "Skin"],
            answer: "Skin"
        },
        {
            question: "What is the result of '7 + 3 * 2'?",
            options: ["14", "20", "13", "17"],
            answer: "13"
        },
        {
            question: "What is the difference between a simile and a metaphor?",
            options: ["A simile uses 'like' or 'as'", "A metaphor uses 'like' or 'as'", "They are the same", "Similes are for poetry"],
            answer: "A simile uses 'like' or 'as'"
        },
        {
            question: "Who developed the theory of relativity?",
            options: ["Isaac Newton", "Stephen Hawking", "Albert Einstein", "Galileo Galilei"],
            answer: "Albert Einstein"
        },
        {
            question: "What is the purpose of the 'for' loop in programming?",
            options: ["To define a function", "To repeat a block of code a specific number of times", "To test a condition", "To print text"],
            answer: "To repeat a block of code a specific number of times"
        },
        {
            question: "Which planet is known as the 'Red Planet'?",
            options: ["Jupiter", "Saturn", "Mars", "Venus"],
            answer: "Mars"
        },
        {
            question: "What is the chemical symbol for gold?",
            options: ["Au", "Ag", "Fe", "Pb"],
            answer: "Au"
        }
    ],
    "10th Grade": [
        {
            question: "What is the process of a cell dividing into two identical daughter cells?",
            options: ["Meiosis", "Mitosis", "Photosynthesis", "Osmosis"],
            answer: "Mitosis"
        },
        {
            question: "Solve for x: x² + 5x + 6 = 0",
            options: ["x = 2, 3", "x = -2, -3", "x = 1, 6", "x = -1, -6"],
            answer: "x = -2, -3"
        },
        {
            question: "In physics, what is the law of conservation of energy?",
            options: ["Energy can be created or destroyed", "Energy cannot be created or destroyed", "Energy is always lost as heat", "Energy is always gained"],
            answer: "Energy cannot be created or destroyed"
        },
        {
            question: "What literary device is the repetition of initial consonant sounds in a sentence or phrase?",
            options: ["Alliteration", "Metaphor", "Onomatopoeia", "Hyperbole"],
            answer: "Alliteration"
        },
        {
            question: "In computer programming, what does 'HTTP' stand for?",
            options: ["Hypertext Transfer Protocol", "Hyper Transfer Text Protocol", "Hyperlink Transfer Protocol", "High-Tech Transfer Protocol"],
            answer: "Hypertext Transfer Protocol"
        },
        {
            question: "What is the primary function of DNA?",
            options: ["To provide energy to the cell", "To regulate body temperature", "To store genetic information", "To transport oxygen in the blood"],
            answer: "To store genetic information"
        },
        {
            question: "What is the inverse function of f(x) = 2x + 3?",
            options: ["f⁻¹(x) = x/2 - 3", "f⁻¹(x) = (x-3)/2", "f⁻¹(x) = x - 3/2", "f⁻¹(x) = 2x - 3"],
            answer: "f⁻¹(x) = (x-3)/2"
        },
        {
            question: "What is the SI unit of pressure?",
            options: ["Newton", "Pascal", "Joule", "Watt"],
            answer: "Pascal"
        },
        {
            question: "Which poetic form is a fourteen-line poem with a specific rhyme scheme?",
            options: ["Haiku", "Sonnet", "Limerick", "Epic"],
            answer: "Sonnet"
        },
        {
            question: "In chemistry, what is an acid?",
            options: ["A substance that accepts a proton", "A substance that donates a proton", "A substance with a pH greater than 7", "A substance with a pH of exactly 7"],
            answer: "A substance that donates a proton"
        },
        {
            question: "What is the common name for the compound NaCI?",
            options: ["Baking Soda", "Table Salt", "Sugar", "Vinegar"],
            answer: "Table Salt"
        },
        {
            question: "Who was the primary author of the Declaration of Independence?",
            options: ["George Washington", "Benjamin Franklin", "Thomas Jefferson", "John Adams"],
            answer: "Thomas Jefferson"
        },
        {
            question: "In computer science, what is a boolean variable?",
            options: ["A variable that stores a number", "A variable that stores text", "A variable that stores a true or false value", "A variable that stores an image"],
            answer: "A variable that stores a true or false value"
        },
        {
            question: "What is the force of attraction between objects with mass?",
            options: ["Electromagnetism", "Strong nuclear force", "Weak nuclear force", "Gravity"],
            answer: "Gravity"
        },
        {
            question: "What is the name of the process by which a cell engulfs a large particle?",
            options: ["Exocytosis", "Phagocytosis", "Diffusion", "Osmosis"],
            answer: "Phagocytosis"
        }
    ],
    "11th Grade": [
        {
            question: "What is the chemical formula for sulfuric acid?",
            options: ["H2SO4", "HCl", "HNO3", "H2CO3"],
            answer: "H2SO4"
        },
        {
            question: "What is the derivative of f(x) = x³ + 2x² + 5?",
            options: ["f'(x) = 3x² + 4x", "f'(x) = 3x + 4", "f'(x) = 3x³ + 4x²", "f'(x) = 3x² + 4x + 5"],
            answer: "f'(x) = 3x² + 4x"
        },
        {
            question: "What is the 'Doppler effect'?",
            options: ["A change in wavelength of light as the source moves", "The bending of light as it passes through a medium", "The reflection of sound waves", "The process of light hitting a surface"],
            answer: "A change in wavelength of light as the source moves"
        },
        {
            question: "In Shakespeare's 'Hamlet,' who is the Prince of Denmark?",
            options: ["Claudius", "Laertes", "Hamlet", "Polonius"],
            answer: "Hamlet"
        },
        {
            question: "In computer science, what is a 'stack'?",
            options: ["A data structure that follows the LIFO principle", "A data structure that follows the FIFO principle", "A type of database", "A computer virus"],
            answer: "A data structure that follows the LIFO principle"
        },
        {
            question: "What is the main function of the kidneys?",
            options: ["To pump blood", "To filter waste products from the blood", "To produce hormones", "To regulate body temperature"],
            answer: "To filter waste products from the blood"
        },
        {
            question: "What is the logarithm of 1000 to the base 10?",
            options: ["10", "100", "3", "0.1"],
            answer: "3"
        },
        {
            question: "What is the difference between a series circuit and a parallel circuit?",
            options: ["In series, current is shared; in parallel, it is constant", "In series, voltage is shared; in parallel, it is constant", "In series, current is constant; in parallel, it is constant", "In series, current is constant; in parallel, it is shared"],
            answer: "In series, current is constant; in parallel, it is shared"
        },
        {
            question: "Who wrote 'The Great Gatsby'?',",
            options: ["Ernest Hemingway", "F. Scott Fitzgerald", "William Faulkner", "Mark Twain"],
            answer: "F. Scott Fitzgerald"
        },
        {
            question: "What is the purpose of a compiler?",
            options: ["To translate high-level code into machine code", "To run a program", "To debug code", "To design a website"],
            answer: "To translate high-level code into machine code"
        },
        {
            question: "In biology, what is the purpose of the Calvin cycle?",
            options: ["To produce ATP", "To fix carbon dioxide into glucose", "To break down glucose for energy", "To transport water in plants"],
            answer: "To fix carbon dioxide into glucose"
        },
        {
            question: "Solve for x: sin(x) = 1, where 0 ≤ x ≤ 2π",
            options: ["π/2", "π", "3π/2", "2π"],
            answer: "π/2"
        },
        {
            question: "What is the primary function of an operating system?",
            options: ["To manage hardware and software resources", "To create documents", "To browse the internet", "To play video games"],
            answer: "To manage hardware and software resources"
        },
        {
            question: "What does 'quantum' mean in quantum mechanics?",
            options: ["A continuous quantity", "A large amount", "A discrete packet", "An infinite value"],
            answer: "A discrete packet"
        },
        {
            question: "Which of the following is a type of protein?",
            options: ["Glucose", "Enzyme", "Lipid", "DNA"],
            answer: "Enzyme"
        }
    ],
    "12th Grade": [
        {
            question: "What is the main principle of the 'Hardy-Weinberg principle'?",
            options: ["Mutation rates in a population", "Genetic variation will remain constant without external factors", "The rate of natural selection", "The speed of evolution"],
            answer: "Genetic variation will remain constant without external factors"
        },
        {
            question: "What is the integral of f(x) = 2x?",
            options: ["x² + C", "2x + C", "2x² + C", "x + C"],
            answer: "x² + C"
        },
        {
            question: "According to Newton's Third Law of Motion, for every action, there is an equal and opposite...",
            options: ["force", "reaction", "velocity", "acceleration"],
            answer: "reaction"
        },
        {
            question: "Who wrote the novel '1984'?",
            options: ["Aldous Huxley", "George Orwell", "Ray Bradbury", "J.R.R. Tolkien"],
            answer: "George Orwell"
        },
        {
            question: "What is the term for a recursive function that calls itself infinitely?",
            options: ["Base case", "Stack overflow", "Infinite loop", "Recursive call"],
            answer: "Infinite loop"
        },
        {
            question: "What is the purpose of the Krebs Cycle (Citric Acid Cycle)?",
            options: ["To produce glucose", "To produce ATP and CO2", "To produce oxygen", "To break down water"],
            answer: "To produce ATP and CO2"
        },
        {
            question: "Solve the limit: lim(x→∞) (3x² - 2x + 1) / (4x² + 5x - 6)",
            options: ["0", "∞", "3/4", "-2/5"],
            answer: "3/4"
        },
        {
            question: "What is the difference between an intrinsic and an extrinsic semiconductor?",
            options: ["Intrinsic is a pure semiconductor; extrinsic is doped", "Intrinsic has more free electrons; extrinsic has fewer", "Extrinsic is a better insulator", "Intrinsic semiconductors are always found in nature"],
            answer: "Intrinsic is a pure semiconductor; extrinsic is doped"
        },
        {
            question: "In literature, what is a 'bildungsroman'?",
            options: ["A novel of manners", "A coming-of-age novel", "A detective story", "A science fiction novel"],
            answer: "A coming-of-age novel"
        },
        {
            question: "What is a 'pointer' in C++?",
            options: ["A variable that stores a memory address", "A function that returns a value", "A loop that repeats a specific number of times", "A type of class"],
            answer: "A variable that stores a memory address"
        },
        {
            question: "What is the primary function of an operating system?",
            options: ["To manage hardware and software resources", "To create documents", "To browse the internet", "To play video games"],
            answer: "To manage hardware and software resources"
        },
        {
            question: "What does 'quantum' mean in quantum mechanics?",
            options: ["A continuous quantity", "A large amount", "A discrete packet", "An infinite value"],
            answer: "A discrete packet"
        },
        {
            question: "What is the force between two charged particles?",
            options: ["Gravity", "Electromagnetic force", "Nuclear force", "Friction"],
            answer: "Electromagnetic force"
        },
        {
            question: "In genetics, what is the term for a specific location on a chromosome?",
            options: ["Allele", "Locus", "Gene", "Trait"],
            answer: "Locus"
        }
    ]
};

const grades = ["8th Grade", "9th Grade", "10th Grade", "11th Grade", "12th Grade"];
let currentAttempt = 0;
let currentQuestionIndex = 0;
const userAnswers = [];
let timer;
const TIME_PER_QUESTION = 60; // 1 minute = 60 seconds

const questionContainer = document.getElementById('question-container');
const nextButton = document.getElementById('next-btn');
const submitButton = document.getElementById('submit-btn');
const resultsContainer = document.getElementById('results');
const gradeTitle = document.getElementById('grade-title');
const timeLeftSpan = document.getElementById('time-left');

// Function to shuffle an array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function startTimer() {
    let timeLeft = TIME_PER_QUESTION;
    timeLeftSpan.textContent = timeLeft;
    timer = setInterval(() => {
        timeLeft--;
        timeLeftSpan.textContent = timeLeft;
        if (timeLeft <= 0) {
            clearInterval(timer);
            nextQuestion();
        }
    }, 1000);
}

function stopTimer() {
    clearInterval(timer);
}

function triggerRipple(event, element) {
    const rect = element.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;

    element.style.setProperty('--x', `${x}px`);
    element.style.setProperty('--y', `${y}px`);

    element.classList.add('ripple-active');

    element.addEventListener('animationend', () => {
        element.classList.remove('ripple-active');
    }, { once: true });
}

function renderQuestion() {
    stopTimer();
    const questions = allQuestions[grades[currentAttempt]];
    const q = questions[currentQuestionIndex];
    questionContainer.innerHTML = '';

    const questionDiv = document.createElement('div');
    questionDiv.classList.add('question-card');
    questionDiv.innerHTML = `<div class="question"><p>${currentQuestionIndex + 1}. ${q.question}</p></div>`;

    const optionsDiv = document.createElement('div');
    optionsDiv.classList.add('options');

    q.options.forEach(option => {
        const label = document.createElement('label');
        const radioId = `q${currentQuestionIndex}-option-${option.replace(/\s/g, '-')}`;
        label.innerHTML = `<input type="radio" id="${radioId}" name="question" value="${option}"> <span>${option}</span>`;
        optionsDiv.appendChild(label);

        label.addEventListener('click', (event) => {
            triggerRipple(event, label);
            const selectedOption = label.querySelector('input');
            userAnswers[currentQuestionIndex] = selectedOption.value;
        });
    });

    questionDiv.appendChild(optionsDiv);
    questionContainer.appendChild(questionDiv);

    if (currentQuestionIndex === questions.length - 1) {
        nextButton.style.display = 'none';
        submitButton.style.display = 'block';
    } else {
        nextButton.style.display = 'block';
        submitButton.style.display = 'none';
    }
    
    startTimer();
}

function showAllAnswers() {
    stopTimer();
    resultsContainer.innerHTML = '';
    const questions = allQuestions[grades[currentAttempt]];
    let score = 0;

    questions.forEach((q, index) => {
        const resultItem = document.createElement('div');
        resultItem.classList.add('question-card');

        const isCorrect = userAnswers[index] === q.answer;
        if (isCorrect) {
            score++;
            resultItem.classList.add('correct');
        } else {
            resultItem.classList.add('incorrect');
        }

        let feedback = '';
        if (userAnswers[index]) {
            feedback = `<p>Your Answer: <strong>${userAnswers[index]}</strong></p>`;
        } else {
            feedback = `<p>You did not answer this question.</p>`;
        }

        resultItem.innerHTML = `
            <div class="question">
                <p>${index + 1}. ${q.question}</p>
                <p>Correct Answer: <strong>${q.answer}</strong></p>
                ${feedback}
            </div>
        `;
        resultsContainer.appendChild(resultItem);
    });

    const finalScore = document.createElement('h3');
    finalScore.textContent = `Final Score: ${score} out of ${questions.length}`;
    resultsContainer.prepend(finalScore);

    const retakeButton = document.createElement('button');
    retakeButton.id = 'retake-btn';
    retakeButton.textContent = "Retake Test";
    retakeButton.style.display = 'block';
    retakeButton.style.marginTop = '20px';
    resultsContainer.appendChild(retakeButton);

    retakeButton.addEventListener('click', retakeTest);
}

function nextQuestion() {
    stopTimer();
    const questions = allQuestions[grades[currentAttempt]];
    const selectedAnswer = document.querySelector('input[name="question"]:checked');

    if (selectedAnswer) {
        userAnswers[currentQuestionIndex] = selectedAnswer.value;
    } else {
        userAnswers[currentQuestionIndex] = null;
    }

    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
        renderQuestion();
    } else {
        questionContainer.style.display = 'none';
        nextButton.style.display = 'none';
        showAllAnswers();
    }
}

function retakeTest() {
    const nextGradeIndex = grades.indexOf(grades[currentAttempt]) + 1;
    if (nextGradeIndex < grades.length) {
        currentAttempt = nextGradeIndex;
        currentQuestionIndex = 0;
        userAnswers.length = 0;

        gradeTitle.textContent = `${grades[currentAttempt]} Brain Teasers`;

        resultsContainer.innerHTML = '';
        questionContainer.style.display = 'block';
        submitButton.style.display = 'none';

        allQuestions[grades[currentAttempt]] = shuffleArray(allQuestions[grades[currentAttempt]]);

        renderQuestion();
    } else {
        alert("You have completed all the tests! Great job!");
        document.getElementById('retake-btn').disabled = true;
    }
}

nextButton.addEventListener('click', nextQuestion);
submitButton.addEventListener('click', showAllAnswers);

window.onload = () => {
    allQuestions[grades[currentAttempt]] = shuffleArray(allQuestions[grades[currentAttempt]]);
    renderQuestion();
};